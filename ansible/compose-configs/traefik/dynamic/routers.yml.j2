---
# routes.yml

http:
  routers:
    # dsm on ds224
    ds224:
      rule: "Host(`nas.{{ vault_traefik_domain }}`) || Host(`ds224.{{ vault_traefik_domain }}`)"
      service: ds224
      entryPoints: &https
        - websecure
      middlewares:
        - lan-only@file
      tls: &tls
        certResolver: production
        domains:
          - main: "{{ vault_traefik_domain }}"
            sans: "*.{{ vault_traefik_domain }}"
    # photos on ds224
    # use the same service but allow world access
    ds224-dsm:
      rule: "(Host(`nas.{{ vault_traefik_domain }}`) || Host(`ds224.{{ vault_traefik_domain }}`)) && (PathRegexp(`^/photo/(mo/sharing|synofoto).*$`)) || (PathRegexp(`^/drive/d.*$`)) || (PathPrefix(`/sharing`)) || (PathPrefix(`/webman`)) || (PathPrefix(`/scripts`))"
      service: ds224
      entryPoints: *https
      middlewares: []
      tls: *tls
    # garage s3 on ds224
    ds224-s3:
      rule: "Host(`s3.{{ vault_traefik_domain }}`)"
      service: ds224-s3
      entryPoints: *https
      middlewares:
        - lan-only@file
        - compression@file
      tls: *tls
    # garage webui on ds224
    ds224-garage:
      rule: "Host(`garage.{{ vault_traefik_domain }}`)"
      service: ds224-garage
      entryPoints: *https
      middlewares:
        - lan-only@file
        - compression@file
      tls: *tls
    # dsm-calibre on ds224
    ds224-calibre:
      rule: "Host(`calibre.{{ vault_traefik_domain }}`)"
      service: ds224-calibre
      entryPoints: *https
      middlewares:
        # - lan-only@file
      tls: *tls
    # kosync on ds224
    ds224-kosync:
      rule: "Host(`kosync.{{ vault_traefik_domain }}`)"
      service: ds224-kosync
      entryPoints: *https
      middlewares:
        # - lan-only@file
      tls: *tls
    # jellyfin on ds224
    ds224-jellyfin:
      rule: "Host(`jellyfin.{{ vault_traefik_domain }}`)"
      service: ds224-jellyfin
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # joplin on ds224
    ds224-joplin:
      rule: "Host(`joplin.{{ vault_traefik_domain }}`)"
      service: ds224-joplin
      entryPoints: *https
      tls: *tls
    # audiobookshelf on ds224
    ds224-audiobookshelf:
      rule: "Host(`audiobooks.{{ vault_traefik_domain }}`)"
      service: ds224-audiobookshelf
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # navidrome on ds224
    ds224-navidrome:
      rule: "Host(`music.{{ vault_traefik_domain }}`) || Host(`navidrome.{{ vault_traefik_domain }}`)"
      service: ds224-navidrome
      entryPoints: *https
      tls: *tls
    # paperless-ngx on ds224
    ds224-paperless:
      rule: "Host(`paperless.{{ vault_traefik_domain }}`) || Host(`paperless-ngx.{{ vault_traefik_domain }}`)"
      service: ds224-paperless
      middlewares:
        - lan-only@file
      entryPoints: *https
      tls: *tls
    # radio on ds224
    ds224-radio:
      rule: "Host(`radio.{{ vault_traefik_domain }}`)"
      service: ds224-radio
      # add auth middleware in the future
      middlewares:
        - lan-only@file
      entryPoints: *https
      tls: *tls
    # vault on ds224
    ds224-vault:
      rule: "Host(`vault.{{ vault_traefik_domain }}`)"
      service: ds224-vault
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # homarr on ds224
    ds224-homarr:
      rule: "Host(`homarr.{{ vault_traefik_domain }}`) || Host(`home.{{ vault_traefik_domain }}`)"
      service: ds224-homarr
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # infisical on ds224
    ds224-infisical:
      rule: "Host(`infisical.{{ vault_traefik_domain }}`) || Host(`secrets.{{ vault_traefik_domain }}`)"
      service: ds224-infisical
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # dsm on ds216
    ds216:
      rule: "Host(`ds216.{{ vault_traefik_domain }}`)"
      service: ds216
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # proxmox on firebat
    proxmox:
      rule: "Host(`proxmox.{{ vault_traefik_domain }}`)"
      service: proxmox
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
    # grafana on proxmox
    proxmox-grafana:
      rule: "Host(`grafana.{{ vault_traefik_domain }}`)"
      service: proxmox-grafana
      entryPoints: *https
      middlewares:
        - lan-only@file
      tls: *tls
